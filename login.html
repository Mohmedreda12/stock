<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title data-i18n="login_title">تسجيل الدخول</title>

  <link rel="stylesheet" href="styles.css" />
  <meta name="color-scheme" content="dark light" />
</head>
<body class="rtl app-body" data-page="login">
  <header id="topbar"></header>

  <main class="container" style="max-width:520px">
    <div class="card">
      <h2 class="title" data-i18n="login_title" style="text-align:center;margin-top:0">تسجيل الدخول</h2>

      <div class="grid">
        <div>
          <label class="label" for="user" data-i18n="login_user">المعرف</label>
          <input id="user" class="input" autocomplete="username" />
        </div>
        <div>
          <label class="label" for="pass" data-i18n="login_pass">كلمة السر</label>
          <input id="pass" class="input" type="password" autocomplete="current-password" />
        </div>
      </div>

      <div class="row mt-3" style="gap:8px;justify-content:flex-end">
        <button id="loginBtn" class="btn btn-primary" data-i18n="login_btn">دخول</button>
      </div>

      <p id="loginErr" style="margin:12px 0 0; color:#f87171; font-weight:700; display:none;"></p>
    </div>
  </main>

  <script defer src="i18n.js"></script>
  <script defer src="app.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      try { renderTopbar('login'); wireTopbar('login'); } catch {}
      try { applyStaticTexts?.(document); } catch {}

      // لو كنت مسجل قبل كده يودّيك الرئيسية
      if (window.isAuthed?.()) location.replace('index.html');

      const $ = (id)=>document.getElementById(id);
      $('loginBtn').addEventListener('click', async () => {
        const u = $('user').value.trim();
        const p = $('pass').value;
        const ok = await window.login?.(u, p);
        if (ok) location.replace('index.html');
        else {
          const el = $('loginErr');
          el.textContent = (typeof t==='function'?t('login_err'):'بيانات غير صحيحة');
          el.style.display = 'block';
        }
      });

      // Enter submits
      document.addEventListener('keydown', (e)=>{
        if(e.key==='Enter') document.getElementById('loginBtn').click();
      });
    });
  </script>
</body>
</html>
